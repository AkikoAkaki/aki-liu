{{ $variant := "" }}
{{ $context := . }}
{{ with .variant }}
    {{ $variant = . }}
{{ end }}
{{ with .context }}
    {{ $context = . }}
{{ end }}
{{ $classes := (slice "tag-sidebar") }}
{{ if eq $variant "inline" }}
    {{ $classes = $classes | append "tag-sidebar--inline" }}
{{ else }}
    {{ $classes = $classes | append "tag-sidebar--sidebar" }}
{{ end }}
<div class="{{ delimit $classes " " }}">
    {{/* Collect tags from current context's pages (usually a section) */}}
    {{ $tags := dict }}
    {{ range $context.Pages }}
        {{ range .Params.tags }}
            {{ $currentCount := index $tags . | default 0 }}
            {{ $tags = merge $tags (dict . (add $currentCount 1)) }}
        {{ end }}
    {{ end }}
    
    {{/* Get keys and sort them */}}
    {{ $keys := slice }}
    {{ range $k, $v := $tags }}
        {{ $keys = $keys | append $k }}
    {{ end }}
    {{ $keys = sort $keys }}

    {{ if gt (len $keys) 0 }}
    <div class="tag-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
        {{ range $keys }}
            {{ $name := . }}
            {{ $count := index $tags $name }}
            <a href="{{ "/tags/" | relLangURL }}{{ $name | urlize }}" class="tag-item">
                <span>#{{ $name }}</span>
                <span class="tag-count">{{ $count }}</span>
            </a>
        {{ end }}
    </div>
    {{ end }}
    
    <style>
        .tag-item {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, auto);
            justify-content: space-between;
            align-items: center;
            column-gap: 1rem;
            color: var(--text-meta);
            text-decoration: none;
            transition: color 0.2s ease;
            font-size: 0.95rem;
        }
        .tag-item:hover {
            color: var(--text-color);
        }
        .tag-count {
            color: inherit;
            opacity: 1;
            margin-left: auto;
            text-align: center;
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum" 1;
        }
    </style>
</div>
